---
layout:     post
title:      HTTP协议基础
subtitle:   
date:       2018-09-25
author:     xiezht
header-img: 
catalog: true
tags: 
    - 笔记
---

内容来源:

1. [HTTP协议入门-阮一峰](http://www.ruanyifeng.com/blog/2016/08/http.html)
2. [HTTP教程 \| 菜鸟教程](http://www.runoob.com/http/http-tutorial.html)


## HTTP协议

一些基本概念：

* 基于TCP/IP通信协议来传递数据
* 工作于客户端/服务端架构
  + 使用URL(统一资源标识符)来传输数据和建立连接
  + 客户端和服务端都是应用程序。如Web浏览器作为客户端发送HTTP请求，Apache Web服务器作为服务端发送响应数据。
* 三个特点：
  + 无连接，每次连接只处理一个请求，服务器对请求做出应答之后就断开连接
  + 媒体独立的。任何类型的数据都可以通过HTTP发送，客户端以及服务器指定使用适合MIME-Type内容类型
  + 无状态的。对事务的处理没有记忆能力。


### HTTP消息结构

分为两类：一类是请求消息，另一类是响应消息。

**客户端请求消息**：

* 请求行：
  + 请求方法
  + URL
  + 协议版本
* 请求头部
  + 头部字段名+值
* 空行
* 请求数据

**服务器响应信息**：

* 状态行
* 消息报头
* 空行
* 响应正文

### HTTP请求方法

**1.0及1.1版本**：

* GET：请求指定的页面信息，返回实体主体
* HEAD：类似GET，但只获取头部
* POST：向指定**资源**提交**数据**进行处理请求，数据包含在请求体内。并可能会导致新的资源的**创建**或者已有资源的**修改**
* PUT：从客户端向服务器传送的数据**取代**指定的文档的内容
* DELETE：请求服务器删除指定的页面
* CONNECT：HTTP/1.1协议中预留给 能够将连接改为管道方式的代理服务器
* OPTIONS：允许客户端查看服务器的性能
* TRACE：回显服务器收到的请求，一般用于**测试/诊断**


### HTTP响应头信息

* Allow：服务器支持的请求方法
* Content-Encoding：响应内容的编码方式
  + 服务端应该根据请求信息的请求头部的Accent-Encoding来返回客户端接受的编码信息
* Content-Length：浏览器使用持久HTTP连接时需要该数据。
* Content-Type：文档的MIME类型。默认text/plain。
  + HttpServletResponse.setContenType
* Date：当前GMT时间。
  + HttpServletResponse.setDateHeader
* Expires：文档过期时间，过期则不再缓存
* Last-Modified：文档的最后改动时间。
  + if-Modified-Since：客户端请求头，对应请求视为一个条件GET
* Location：表示客户应当到哪里提取文档。
  + HttpServletResponse.sendRedirect
* Refresh：表示浏览器应该在多长事件后刷新文档。（扩展，不属于HTTP1.1正式规范）
* Server：服务器名字
* Set-Cookie：设置和页面关联的Cookie
  + HttpServletResponse.addCookie
* WWW-Authenticate：客户应提供的授权信息。

### HTTP状态码分类

* 1** 信息，服务器收到请求，需要请求者继续执行操作
* 2** 成功，操作被成功接收并处理
* 3** 重定向，需要进一步操作以完成请求
* 4** 客户端错误，请求包含语法错误或无法完成请求
* 5** 服务器错误，服务器在处理请求的过程中发生了错误

**常见的状态码**

| 状态码 | 名称 | 描述 |
| - | - | - |
| 100 | Continue | 客户端应继续请求 |
| 101 | Switching Protocols | 服务器根据客户端的请求切换至更高级的协议 |
| --- |
| 200 | OK | 请求成功 |
| 201 | Created | 成功请求并创建了资源 |
| 202 | Accept | 已接受请求，但未完成处理 |
| 205 | Reset Content | 服务器处理请求成功，客户端应重置内容 |
| --- |
| 300 | Multiple Choices | 请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择 |
| 301 | Moved Permenantly | 永久移动 |
| 302 | Found | 临时移动，客户端应继续使用当前url |
| 305 | Use Agent | 用户所访问的资源应该通过代理访问 |
| --- |
| 400 | Bad Request | 请求的语法错误，服务器无法理解 |
| 401 | Unauthorized | 请求需要身份认证 |
| 403 | Forbidden | 服务器理解请求，但拒绝处理请求 |
| 404 | Not Found | **服务器无法根据客户端的请求找到资源（网页）** |
| 405 | Method Not Allowed | 客户端请求的方法被终止 |
| --- |
| 500 | Internal Server Error | 服务器内部错误无法完成请求 |
| 501 | Not Implemented	| 服务器不支持请求的功能，无法完成请求 |
| 502 | Bad GateWay | 充当网关或代理的服务器，从远端服务器接收到了一个无效的请求 |
| 503 | Service Unavailable | 超载或者系统维护 |
| 504 | Gateway Time-out |	充当网关或代理的服务器，未及时从远端服务器获取请求|


## HTTP/2

**二级制协议**

HTTP/1.1头信息是ASCII编码的文本，而HTTP/2是二进制协议，头信息和数据体都是二进制，统称为帧（frame）。可以定义额外的帧，二进制解析更方便


**多工**

**双向，实时**的通信。客户端和浏览器都可以同时发送多个请求或者回应。服务器可以返回部分处理好的数据。

**数据流**

每个请求或者回应的所有数据包称为一个数据流。

数据流拥有唯一的id标识，客户端发出的为奇数，服务器发出的为偶数。数据包必须做**标记**以区分所属的数据流。

客户端和服务端可以发送RST_STREAM取消数据流，而不需要关闭TCP连接。

客户端可以指定数据流的优先级。

**头信息压缩**

HTTP协议是无状态的，每次请求都必须附上所有信息，导致字段的重复，浪费带宽。

* 头信息压缩机制: gzip/compress
* 客户端和服务端同时维护一直头信息表，使用索引号

**服务器推送**

HTTP/2允许服务器未经请求，主动向客户端发送资源，这叫做服务器推送（server push）。




