---
layout:     post
title:      计算机图形学之光照
subtitle:   
date:       2018-4-11
author:     xiezht
header-img: 
catalog: true
tags:
    - 计算机图形学
    - OpenGL
---

## 颜色

在现实生活中看到某一物体的颜色并不是这个物体真正拥有的颜色，而是它所反射的(Reflected)颜色。

物体的颜色可以定义为**物体从一个光源反射各个颜色分量的大小。**

	// 光源：白光
	glm::vec3 lightColor(1.0f, 1.0f, 1.0f);
	// 物体颜色：珊瑚红
	glm::vec3 objColor(1.0f, 0.5f, 0.31f);
	//  反射结果：珊瑚红
	glm::vec3 result = lightColor * objColor;
	// = (1.0f, 0.5f, 0.31f)，

如果光源是绿光 (0.0f, 1.0f, 0.0f)，结果是怎样呢？


## 光照


### lambert余弦定理

**使用单位向量**

### 镜面反射

高光现象

### 经验模型

* 角度下降
* 基于实践经验而非物理基础

计算公式：


### Phong光照模型

环境光、漫反射以及镜面反射的线性组合

#### 环境光照

简单的全局光照模型。

使用很小的常量颜色，添加到物体的最终颜色中。

简单的着色器部分代码如下：

	void main() {
		//  常量因子
		float ambientStrength = 0.1;
		//  环境光
		vec ambient = ambientStrength * lightColor;
		//  添加到物体颜色
		vec3 result = ambient * objectColor;
    	FragColor = vec4(result, 1.0);
	}

#### 漫反射光照

光源所发出的光线落在物体的一个**片段**上。我们需要测量这个光线是以什么**角度**接触到这个片段的。

光线**垂直**于物体表面，则这束光对物体的影响会最大化（物体会更亮）。

计算漫反射光照需要两个条件：

* 法向量：垂直于片段表面的一个向量
* 定向的光线：**光源的位置与片段的位置之间向量差**的方向向量。可由**光的位置向量**和**片段的位置向量**计算得到。


##### 计算漫反射光照

需要片段位置->在世界空间中进行所有的光照计算->model \* pos

着色器代码：

	out vec3 FragPos;  
	out vec3 Normal;

	void main()
	{
		//  物体标准化屏幕坐标位置
    	gl_Position = projection * view * model * vec4(aPos, 1.0);
    	//  片段顶点位置（世界坐标空间）
    	FragPos = vec3(model * vec4(aPos, 1.0));
    	//  正交向量（简单模型->在顶点坐标矩阵内于先算好的）
    	Normal = aNormal;
	}

计算光源与片段位置的方向向量（需要转换为单位向量）。计算光照时一般不关心向量的模长或者位置，只关心方向。

（标准化向量可以简化计算。比如点乘。）

	vec3 norm = normalize(Normal);
	vec3 lightDir = normalize(lightPos - FragPos);

计算光源对片段的漫反射影响：法向量与光照方向进行点乘。

	//  避免出现负数颜色的光照
	float diff = max(dot(norm, lightDir), 0.0);
	vec3 diffuse = diff * lightColor;

（环境光+漫反射分量）* 物体颜色 => 片段输出颜色

	vec3 result = (ambient + diffuse) * objectColor;
	FragColor = vec4(result, 1.0);




##### 法向量

垂直于顶点表面的单位向量。

顶点本身没有表面，需要利用周围的顶点来计算该顶点的表面——叉乘。





## Shading
***
> the process of determining the colors of all the pixels
covered by a surface using an illumination model

### Flat Shading
***

### Gouraud Shading
***
马赫带效应

### Phong Shading
***
区别于Phong光照模型。

Phong光照模型：经验模型，计算一个表面上的一个点的光照
Phong Shading：线性插值计算平面每个点的法向量，再对每个像素使用Phong光照模型

* 光滑
* 代价高

